From cc08354ca224e932b6de8f88ace9672150eaa2bb Mon Sep 17 00:00:00 2001
From: Hai Li <hali@codeaurora.org>
Date: Wed, 3 Jun 2015 13:15:15 -0400
Subject: [PATCH 11/41] drm: Force drm_gem_prime_export to use old dma_buf API

Revert drm_prime.c change in
commit d8fbe341beb6 ("dma-buf: cleanup dma_buf_export() to make it easily extensible")

Change-Id: I2bbabd8d292386e939ae93742286d7039d09f98e
Signed-off-by: Hai Li <hali@codeaurora.org>
---
 drivers/gpu/drm/drm_prime.c | 12 ++++--------
 1 file changed, 4 insertions(+), 8 deletions(-)

diff --git a/drivers/gpu/drm/drm_prime.c b/drivers/gpu/drm/drm_prime.c
index 9f935f5..e3274ac 100644
--- a/drivers/gpu/drm/drm_prime.c
+++ b/drivers/gpu/drm/drm_prime.c
@@ -341,17 +341,13 @@ static const struct dma_buf_ops drm_gem_prime_dmabuf_ops =  {
 struct dma_buf *drm_gem_prime_export(struct drm_device *dev,
 				     struct drm_gem_object *obj, int flags)
 {
-	DEFINE_DMA_BUF_EXPORT_INFO(exp_info);
-
-	exp_info.ops = &drm_gem_prime_dmabuf_ops;
-	exp_info.size = obj->size;
-	exp_info.flags = flags;
-	exp_info.priv = obj;
+	struct reservation_object *robj = NULL;
 
 	if (dev->driver->gem_prime_res_obj)
-		exp_info.resv = dev->driver->gem_prime_res_obj(obj);
+		robj = dev->driver->gem_prime_res_obj(obj);
 
-	return dma_buf_export(&exp_info);
+	return dma_buf_export(obj, &drm_gem_prime_dmabuf_ops, obj->size,
+			      flags, robj);
 }
 EXPORT_SYMBOL(drm_gem_prime_export);
 
-- 
2.8.2

